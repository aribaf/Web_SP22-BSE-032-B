/*!taggstar-core 3.21.0 | 2024-11-06T14:39:10 | 2aa4cce879da2e4a1a0a237480c7cef59212b966 | Copyright. All rights reserved. 2024. Digital Media Technologies Ltd.

Promise Polyfill | Copyright (c) 2014 Taylor Hakes - Forbes Lindesay | https://github.com/taylorhakes/promise-polyfill/blob/master/LICENSE*/
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){var e=setTimeout;function s(){}function n(t){if("object"!==_typeof(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(t,this)}function r(a,s){for(;3===a._state;)a=a._value;0!==a._state?(a._handled=!0,n._immediateFn(function(){var t=1===a._state?s.onFulfilled:s.onRejected;if(null!==t){var e;try{e=t(a._value)}catch(t){return void i(s.promise,t)}o(s.promise,e)}else(1===a._state?o:i)(s.promise,a._value)})):a._deferreds.push(s)}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"===(void 0===t?"undefined":_typeof(t))||"function"==typeof t)){var a=t.then;if(t instanceof n)return e._state=3,e._value=t,void g(e);if("function"==typeof a)return void c(function(t,e){return function(){t.apply(e,arguments)}}(a,t),e)}e._state=1,e._value=t,g(e)}catch(t){i(e,t)}}function i(t,e){t._state=2,t._value=e,g(t)}function g(t){2===t._state&&0===t._deferreds.length&&n._immediateFn(function(){t._handled||n._unhandledRejectionFn(t._value)});for(var e=0,a=t._deferreds.length;e<a;e++)r(t,t._deferreds[e]);t._deferreds=null}function l(t,e,a){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=a}function c(t,e){var a=!1;try{t(function(t){a||(a=!0,o(e,t))},function(t){a||(a=!0,i(e,t))})}catch(t){if(a)return;a=!0,i(e,t)}}n.prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,e){var a=new this.constructor(s);return r(this,new l(t,e,a)),a},n.all=function(t){var i=Array.prototype.slice.call(t);return new n(function(s,r){if(0===i.length)return s([]);var n=i.length;function o(e,t){try{if(t&&("object"===(void 0===t?"undefined":_typeof(t))||"function"==typeof t)){var a=t.then;if("function"==typeof a)return void a.call(t,function(t){o(e,t)},r)}i[e]=t,0==--n&&s(i)}catch(t){r(t)}}for(var t=0;t<i.length;t++)o(t,i[t])})},n.resolve=function(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(a){return new n(function(t,e){e(a)})},n.race=function(r){return new n(function(t,e){for(var a=0,s=r.length;a<s;a++)r[a].then(t,e)})},n._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){e(t,0)},n._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},n._setImmediateFn=function(t){n._immediateFn=t},n._setUnhandledRejectionFn=function(t){n._unhandledRejectionFn=t},"undefined"!=typeof module&&module.exports?module.exports=n:t.Promise||(t.Promise=n)}(window),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(t),s=1;s<arguments.length;s++){var r=arguments[s];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},writable:!0,configurable:!0}),window.taggstar||(window.taggstar={lib:{}}),function(o){function u(t){var e,a=taggstar.config,s=taggstar.util,r=t.message||"TAGGSTAR: Error!!",n=function(){try{var t,e=o.navigator&&o.navigator.userAgent,a=e.match(/(opera|chrome|safari|firefox|msie|trident|edge(?=\/))\/?\s*(\d+)(\.\d+)+/i)||[];if(/trident/i.test(a[1]))return{name:"IE",version:(t=/\brv[ :]+(\d+)/g.exec(e)||[])[1]||""};if("Chrome"===a[1]){if(null!=(t=e.match(/\bOPR\/(\d+)/)))return{name:"Opera",version:t[1]};if(null!=(t=e.match(/\bEdge\/(\d+(.\d+)+)/i)))return{name:"Microsoft Edge",version:t[1]}}return a=a[2]?[a[1],a[0].substring(a[0].indexOf("/")+1)]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/(\d+)/i))&&a.splice(1,1,t[1]),{name:a[0],version:a[1]}}catch(t){return{name:"unknown",version:"1"}}}()||{};this.name=t.name||"TaggstarError",this.siteKey=t.siteKey||a&&a.key||taggstar.tm&&taggstar.tm.key,this.code=t.code||"ERR01",this.message=r,this.host=s&&s.getRootDomain()||o.location&&o.location.host,this.href=o.location&&o.location.href,this.timestamp=Date.now(),this.severity=t.severity||50,this.environment=a&&a.environment||taggstar.params&&taggstar.params.taggEnv||"prod",this.browser=n.name,this.browserVersion=n.version,this.locale=o.navigator&&o.navigator.language,this.cookies=function(t){var e=taggstar.util;return e&&"function"==typeof e.getCookie?t.map(function(t){return{name:t,value:e.getCookie(t)}}):null}(["_taggstar_ses","_taggstar_vid","_taggstar_exps"]),this.module=t.module||(a?a.sp.module:null),this.minSeverity=a?a.errorMinSeverity:0,this.sendingProbability=a?a.errorSendingProbability:1,t.stack?this.stack=t.stack:((e=new Error(r)).name=this.name,e.stack?this.stack=e.stack:this.stack=r)}(u.prototype=Object.create(Error.prototype)).constructor=u,taggstar.exception={Error:u,handle:function e(t,a){var s,r,n,o,i,g,l=!1,c=taggstar.util,d=taggstar.log;a=a||0;try{if(!(t instanceof u)&&a<2)throw a+=1,new u({name:t.name,message:t.message,stack:t.stack||t.message});if(!c&&!d)return void console.error("TAGGSTAR:",t);if(taggstar.log(t,"error"),"qa"===t.environment)return;try{c.jsonCall&&t instanceof u&&(n=taggstar.config,i=t.sendingProbability,g=t.minSeverity,r=n&&n.api&&n.api.log,t.severity<g?l=!0:i<=0?l=!0:i<1&&(l=i<(o=Math.random())),taggstar.log(c.renderTemplate("silent mode calculation values are min severity: {errorMinSeverity} - probability: {errorSendingProbability} - random: {random} - silentMode:  {silentMode}}",{errorMinSeverity:g,errorSendingProbability:i,random:o||"NaN",silentMode:l}),"info"),!l&&r&&(s=n.urls.logRoot+r.endpoint)&&c.jsonCall(r.verb,s,JSON.stringify(t)).then(function(t){taggstar.log("log sent successfully","info")}).catch(function(t){taggstar.log(t,"error")}))}catch(t){taggstar.log(t,"error")}}catch(t){e(t,a)}}}}(window),taggstar.initConfig=function(e,s,t,a){s=s||"prod",a=a&&(a+"").trim().toLowerCase();function r(t,e){var a=c[s][e];return l.renderTemplate(t,{alias:a.alias,topLevel:a.topLevel,protocol:a.protocol})}function n(t){return l.renderTemplate(t,{key:e})}var o,i,g=taggstar.exception.Error,l=taggstar.util,c={prod:{api:{topLevel:"com",alias:a?"api."+a:"api",protocol:"https:"},log:{topLevel:"com",alias:a?"log."+a:"log",protocol:"https:"}},qa:{api:{topLevel:"com",alias:"api.qa",protocol:""},log:{topLevel:"com",alias:"log",protocol:""}},dev:{api:{topLevel:"net:8080",alias:"api.dev",protocol:"http:"},log:{topLevel:"net:8080",alias:"log.dev",protocol:"http:"}}};if(!e)throw new g({message:"sitekey should be defined",code:"CONFIG01",severity:99});if(!c[s])throw new g({message:"invalid environment value: "+s,code:"CONFIG02",severity:99,siteKey:e});return o=r("{protocol}//{alias}.taggstar.{topLevel}","api"),i=r("{protocol}//{alias}.taggstar.{topLevel}","log"),{version:"",cookieVersion:"3",idGenerator:taggstar.lib.uuid.generate,key:e,region:a,environment:s,urls:{configRoot:o,apiRoot:o,logRoot:i},currencyCode:"GBP",defaultLocale:"en-GB",locale:"",sitePrefix:"/",deviceType:"",interval:500,tries:50,jquery:"",carouselJS:"",carouselCSS:"",errorMinSeverity:0,errorSendingProbability:1,detail:!1,pageType:"",asst:{experienceRequired:!1,experienceId:"",pageType:""},module:"",experienceRequired:!1,experienceId:"",sp:{experienceRequired:!1,experienceId:"",module:""},api:{category:{endpoint:n("/api/v2/key/{key}/category/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},product:{endpoint:n("/api/v2/key/{key}/product/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},productUpdate:{endpoint:n("/api/v2/key/{key}/product/update"),verb:"POST",mandatoryFields:{},optionalFields:{}},conversion:{endpoint:n("/api/v2/key/{key}/conversion/order"),verb:"POST",mandatoryFields:{},optionalFields:{}},basket:{endpoint:n("/api/v2/key/{key}/basket/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},event:{endpoint:n("/api/v2/key/{key}/event"),verb:"POST"},eventQuery:{endpoint:n("/api/v2/key/{key}/event/query"),verb:"POST"},eventAssistant:{endpoint:n("/api/v2/key/{key}/event/assistant"),verb:"POST"},configuration:{endpoint:n("/api/v2/key/{key}/config{query}"),verb:"GET",mock:t},log:{endpoint:"/api/v1/logs",verb:"POST"},asst:{endpoint:n("/api/v2/key/{key}/recs/assistant"),verb:"POST",mandatoryFields:{},optionalFields:{}},products:{endpoint:n("/api/v2/key/{key}/products"),verb:"GET"}}}},function(){var u=taggstar.exception.Error;taggstar.util={windowWrapper:{getLocation:function(){return window.location},isCookie:function(){return window.navigator.cookieEnabled},setCookie:function(t){document.cookie=t},getCookie:function(){return document.cookie},createElement:function(t){return document.createElement(t)},appendChild:function(t,e){t.appendChild(e)},getElementsByTagName:function(t){return document.getElementsByTagName(t)},getElementById:function(t){return document.getElementById(t)},getXMLHttpRequest:function(){return new XMLHttpRequest},isLocalStorage:function(){var t="_taggstar_test";try{return window.localStorage.setItem(t,t),window.localStorage.removeItem(t),!0}catch(t){return!1}},getLocalStorage:function(t){return window.localStorage.getItem(t)},setLocalStorage:function(t,e){window.localStorage.setItem(t,e)},removeLocalStorage:function(t){return window.localStorage.removeItem(t)}},loadTag:function(i,g,l,c,d){return new Promise(function(t,a){g=g||"script",l=l||"head";var e,s,r=taggstar.util,n=r.windowWrapper,o="src";if(i){switch(e=n.createElement(g),g){case"script":e.async=!0;break;case"link":e.type="text/css",e.rel="stylesheet",o="href"}if(s=n.getElementsByTagName(l),e[o]=i,c&&(e.id=c),d&&(e.integrity=d,e.crossOrigin="anonymous"),e.onload=function(){t({tag:g,url:i,id:c,sri_hash:d})},e.onerror=function(t){var e="string"==typeof t?r.renderTemplate("{error} while requesting url: {url}",{error:t,url:i}):t&&t.message?t.message:r.renderTemplate("error while requesting url: {url}",{url:i});a(new u({message:e,code:"UTIL11",severity:99}))},0<s.length)if(c){if(null!==n.getElementById(c))return void a(new u({message:r.renderTemplate("trying to add an existing tag: <{url}>",{url:i}),code:"UTIL14",severity:99}));n.appendChild(s[0],e)}else n.appendChild(s[0],e);else a(new u({message:r.renderTemplate("no <{parent}> tag found to append url: {url}",{parent:l,url:i}),code:"UTIL12",severity:99}))}else a(new u({message:r.renderTemplate("url not provided for <{tag}> tag injection inside <{parent}> element",{tag:g,parent:l}),code:"UTIL01",severity:99}))})},jsonCall:function(t,o,e){return new Promise(function(a,s){var r=taggstar.util,n=r.windowWrapper.getXMLHttpRequest();if(n){e=e||null,n.open(t,o,!0);try{"responseType"in n&&(n.responseType="json")}catch(t){}n.onload=function(){var t=n.status,e="json"===n.responseType?n.response:JSON.parse(n.responseText);200<=t&&t<300?a(e):s(new u({message:r.renderTemplate("{errorDetail} for url: {url}",{status:t,url:o,errorDetail:e&&e.result&&e.result.errorMessage?e.result.errorMessage:"error"}),code:"UTIL09",severity:81}))},n.onerror=function(){s(new u({message:r.renderTemplate("connection failure for url: {url}",{url:o}),code:"UTIL10",severity:81}))},n.send(e)}else s(new u({message:"failed to create XMLHttpRequest object",code:"UTIL13",severity:81}))})},renderTemplate:function(t,e){var a,s;for(a in e)s=e[a],t=t.replace(new RegExp("{"+a+"}","g"),s);return t},isCookie:function(){return taggstar.util.windowWrapper.isCookie()},setCookie:function(t,e,a){var s,r,n=taggstar&&taggstar.config&&taggstar.config.sitePrefix;if(!t)throw new u({message:"name not defined",code:"UTIL03",severity:81});if(!n)throw new u({message:"sitePrefix not defined",code:"UTIL04",severity:81});r=a?((s=new Date).setTime(s.getTime()+60*a*1e3),"; expires="+s.toUTCString()):"",taggstar.util.windowWrapper.setCookie(t+"="+e+r+"; path="+n+";domain="+taggstar.util.getRootDomain())},getCookie:function(t){var e,a,s=t+"=",r=(taggstar.util.windowWrapper.getCookie()||"").split(";");for(e=0;e<r.length;e++){for(a=r[e];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(s))return a.substring(s.length,a.length)}return null},deleteCookie:function(t){taggstar.util.setCookie(t,"",-1)},saveLocalStorage:function(t,e,a){if(!taggstar.util.windowWrapper.isLocalStorage())return!1;var s=60*(a||30)*1e3,r={value:JSON.stringify(e),timestamp:(new Date).getTime()+s},n="_"+taggstar.config.key;return taggstar.util.windowWrapper.setLocalStorage(t+n,JSON.stringify(r)),e},loadLocalStorage:function(t){if(!taggstar.util.windowWrapper.isLocalStorage())return!1;var e,a="_"+taggstar.config.key;return!!(e=JSON.parse(taggstar.util.windowWrapper.getLocalStorage(t+a)))&&((new Date).getTime()<e.timestamp&&JSON.parse(e.value))},removeLocalStorage:function(t){if(!taggstar.util.windowWrapper.isLocalStorage())return!1;var e="_"+taggstar.config.key;return taggstar.util.windowWrapper.removeLocalStorage(t+e),!0},setPageData:function(t,e,a){a=a||taggstar.config.sp.module||"general",taggstar.pageData=taggstar.pageData||{},taggstar.pageData[a]=taggstar.pageData[a]||{},taggstar.pageData[a][t]=e},getPageData:function(t,e){return e=e||taggstar.config.sp.module||"general",taggstar.pageData=taggstar.pageData||{},taggstar.pageData[e]=taggstar.pageData[e]||{},taggstar.pageData[e][t]},deletePageData:function(t,e){e=e||taggstar.config.sp.module||"general",taggstar.pageData&&taggstar.pageData[e]&&taggstar.pageData[e][t]&&delete taggstar.pageData[e][t]},decodeCookieString:function(t,e){if(!t)return null;var a,s,r,n,o,i,g={cookieVersion:t.substring(2,3)};if(i=parseInt(g.cookieVersion,10),isNaN(i)||3<i)return taggstar.util.deleteCookie("_taggstar_exp"),null;try{for(a=t.split("|"),s=1;s<a.length;s++)switch(n=(r=a[s].split(":"))[0],o="null"==r[1]||"undefined"==r[1]?"":r[1],g.cookieVersion){case"1":switch(n){case"visitor":g.id=o;break;case"basket":case"category":case"product":g.experimentGroup=o;break;default:g.experimentId=o}break;case"2":switch(n){case"visitor":g.id=o;break;case"group":g.experimentGroup=o;break;case"id":g.experimentId=o}break;case"3":switch(n){case"group":g.experimentGroup=o;break;case"id":g.experimentId=o}}e||(g.modules={product:g.experimentGroup,category:g.experimentGroup,basket:g.experimentGroup})}catch(t){taggstar.exception.handle(t),taggstar.util.deleteCookie("_taggstar_exp"),g=null}return g},decodeCookieStringV2:function(t){if(!t)return null;var e=null;try{e=JSON.parse(t)}catch(t){taggstar.exception.handle(t),taggstar.util.deleteCookie("_taggstar_exps"),e=null}return e},getRootDomain:function(){var t,e=taggstar.util.windowWrapper.getLocation().host.toLowerCase(),a=e;return null!=e&&1<(t=e.split(".").reverse()).length&&(a=2<t.length&&("co"===t[1]||"com"===t[1])?t[2]+"."+t[1]+"."+t[0]:t[1]+"."+t[0]),a},cleanDuplicateProducts:function(t){var e,a,s,r,n,o,i,g,l,c={},d=[];if(!t)return[];for(e=0;e<t.length;e++){if(n=(a=t[e]).id,o=parseFloat(a.unitPrice),i=parseFloat(a.quantity),g=a.category,isNaN(o)||isNaN(i))throw new u({message:"invalid product unit price/quantity value",code:"UTIL07",severity:71});if(!n)throw new u({message:"invalid product id",code:"UTIL08",severity:71});if(a.variant)for(l in a.variant)a.variant.hasOwnProperty(l)&&(n+="_"+a.variant[l]);c[n]?c[n].quantity+=i:(c[n]={quantity:i,unitPrice:o,id:a.id},a.category&&(c[n].category=g),a.variant&&(c[n].variant=a.variant),a.stock&&(c[n].stock=a.stock),a.optionIds&&a.optionIds.length&&(c[n].optionIds=a.optionIds))}for(s in c)c.hasOwnProperty(s)&&(r={id:(a=c[s]).id,quantity:a.quantity,unitPrice:a.unitPrice},a.category&&(r.category=a.category),a.variant&&(r.variant=a.variant),a.stock&&(r.stock=a.stock),a.optionIds&&(r.optionIds=a.optionIds),d.push(r));return d},getBalloonClass:function(t,e,a){var s,r,n="balloon";if(!t||!t.code||!t.category)throw new u({message:"invalid message parameter",code:"UTIL06",severity:91});return s="QPH"===t.code,r=!!t.messageTagId,"boolean"==typeof e?s=e:"string"==typeof e&&(n=e),"tagg-reset tagg-"+n+" tagg-"+t.category.toLowerCase()+" tagg-"+t.code+(s?" tagg-hot":"")+(r?" tagg-TAG tagg-"+t.messageTagId.toLowerCase():"")+(a?" "+a:"")},getBalloon:function(t,e,a,s){if(t){a=taggstar.$.extend({decor:!0,closeButton:!1},a);var r,n='<div class="'+taggstar.util.getBalloonClass(t,e,a.extraBalloonClass)+'"><div class="tagg-reset tagg-icon"></div><div class="tagg-reset tagg-txt">'+(t.text?t.text:t.message)+"</div>";return n+=a.decor?'<div class="tagg-reset tagg-decor"></div>':"",n+=a.closeButton?'<div class="tagg-reset tagg-x"></div></div>':"",r=taggstar.$(n),a.iconCss&&r.find(".tagg-icon").css(a.iconCss),a.txtCss&&r.find(".tagg-txt").css(a.txtCss),a.closeCss&&r.find(".tagg-x").css(a.closeCss),void 0!==s&&r.data("tagg-index",s),r}},getBalloonParams:function(t,e,a){var s=a?taggstar._defaultParams.pinnedMessages:taggstar._defaultMessageParams,r=taggstar.$.extend({},s),n=taggstar.$.extend(r,t);return n.wrapperClass+=n.isMobile?"-n":"",n.experienceWrapperClass=taggstar.config.sp.experienceRequired?"tagg-"+taggstar.config.sp.experienceId.replace(/[^_a-zA-Z0-9-]/g,"_"):"",n.callback||"function"!=typeof e||(n.callback=e),n},getParams:function(t,e,a){var s=taggstar.$.extend(taggstar._defaultParams[t],e);return s.wrapperClass+=s.isMobile?"-n":"",s.experienceWrapperClass=taggstar.config[t].experienceRequired?"tagg-"+taggstar.config[t].experienceId.replace(/[^_a-zA-Z0-9-]/g,"_"):"",s.callback||"function"!=typeof a||(s.callback=a),s},getBalloonContainer:function(t){var e="tagg-reset "+t.wrapperClass+(t.extraClass?" "+t.extraClass:"")+(t.experienceWrapperClass?" "+t.experienceWrapperClass:"");return t.wrapperStyle?taggstar.$('<div class="'+e+'"></div>').css(t.wrapperStyle):taggstar.$('<div class="'+e+'"></div>')},getQueryParams:function(){var t,e,a,s=taggstar.util.windowWrapper.getLocation().search.substring(1),r={};if(!s)return r;for(t=s.split("&"),e=0;e<t.length;e++)0===(a=t[e].split("="))[0].indexOf("tagg")&&(r[a[0]]=!(1<a.length)||a[1]);return r},createTaggstarQueryString:function(){var t,e="?";for(t in taggstar.params)taggstar.params.hasOwnProperty(t)&&(e+=t+"="+taggstar.params[t]+"&");return taggstar.config.detail&&(e+="detail=true&"),e.slice(0,e.length-1)},validateDimensions:function(t){var e,a,s,r={};if(!t)return r;for(e=1;e<4;e++)(s=t[a="dim"+e])&&"string"==typeof s&&(r[a]=s.substring(0,32));return r},debugDialog:function(t,e,a){if(taggstar.debug){"object"===(void 0===e?"undefined":_typeof(e))&&(e=JSON.stringify(e));var s=taggstar.$('<div id="dialog"></div>');s.append("<h1>"+t+"</h1>"),s.append("<p>"+e+"</p>"),taggstar.$("body").append(s),s.css({position:"fixed",left:"35%",top:"20%",width:"50%",padding:"10px",height:"auto",background:a||"green",color:"white",fontSize:"11px",textAlign:"center",zIndex:1e4})}},getObjectByPath:function(t,e){for(var a=(e=(e=e.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),s=0,r=a.length;s<r;++s){var n=a[s];if(!(n in t))return null;t=t[n]}return t},assistant:{renderAssistantTemplate:function(t,e,a){var s,r,n,o;for(s in e)r=e[s],t=t.replace(new RegExp("{"+s+"}","g"),r);if((n=t.match(/{(\w+)}/g))&&0<n.length&&a)for(var i=0;i<n.length;i++)o=n[i].replace("{","").replace("}",""),t=t.replace(n[i],a[o]);return t},getAssistantCardAttributes:function(t,e,a,s){var r={},n=t;return n&&Object.keys(n).forEach(function(t){if(n.hasOwnProperty(t))switch(t){case"imageUrl":r.imageUrl="function"==typeof e.utils.image?e.utils.image(n.imageUrl):n.imageUrl;break;case"price":r.price="function"==typeof e.utils.price?e.utils.price(n.price,n.salePrice,n.fromPrice):n.price;break;default:r[t]="function"==typeof e.utils[t]?e.utils[t](n[t]):n[t]}}),s&&(r.tagTitle=s.tagTitle,r.tagId=a),r},getAssistantCard:function(t,e,a,s,r){var n,o="main"===t?"tagg-asst-main-card":"tagg-asst-card",i=taggstar.$('<div class="'+o+'"></div>');return a.cardImageTemplate&&i.append(taggstar.util.assistant.renderAssistantTemplate(a.cardImageTemplate,taggstar.util.assistant.getAssistantCardAttributes(e,a,s,r))),a.cardInfoTemplate&&i.append(taggstar.util.assistant.renderAssistantTemplate(a.cardInfoTemplate,taggstar.util.assistant.getAssistantCardAttributes(e,a,s,r))),a.cardAdditionalTemplate&&i.append(taggstar.util.assistant.renderAssistantTemplate(a.cardAdditionalTemplate,taggstar.util.assistant.getAssistantCardAttributes(e,a,s,r))),e.socialProofMessages&&0<e.socialProofMessages.length&&(n=taggstar.util.assistant.getAssistantBalloon(e.socialProofMessages,a),a.balloonAnchor?i.find(a.balloonAnchor)[a.balloonAnchorInsertFunction](n):i[a.balloonAnchorInsertFunction](n)),i},getAssistant:function(e,a,s,t){if(a){var r,n=s.tagClass+" tagg-asst-"+e.toLowerCase()+(t?" "+s.contentSelectedTagSectionClass:""),o='<section data-tag="'+e+'" class="'+n+'"></section>',i=a.sortBy||"popularity";return r=taggstar.$(o),a.products.sort(function(t,e){return t[i]-e[i]}).forEach(function(t){r.append(taggstar.util.assistant.getAssistantCard(e,t,s,"list",a))}),r}},getAssistantBalloon:function(t,e){var a,s,r,n="tagg-reset "+e.balloonWrapperClass+(e.balloonExtraClass?" "+e.balloonExtraClass:""),o=taggstar.$('<div class="'+n+'"></div>');return t.forEach(function(t){a="tagg-reset tagg-asst-balloon tagg-"+t.category.toLowerCase()+" tagg-"+t.code+("QPH"===t.code?" tagg-hot":"")+(e.balloonExtraBalloonClass?" "+e.balloonExtraBalloonClass:""),s='<div class="'+a+'"><div class="tagg-reset tagg-icon"></div><div class="tagg-reset tagg-txt">'+t.message+"</div>",s+=e.balloonDecor?'<div class="tagg-reset tagg-decor"></div>':"",s+=e.balloonCloseButton?'<div class="tagg-reset tagg-x"></div></div>':"",r=taggstar.$(s),o.append(r)}),o}}}}(),function(){var t;if(!t){var a=new Array(16);t=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),a[e]=t>>>((3&e)<<3)&255;return a}}for(var e=Array,r=[],n={},s=0;s<256;s++)r[s]=(s+256).toString(16).substr(1),n[r[s]]=s;function p(t,e){var a=e||0,s=r;return s[t[a++]]+s[t[a++]]+s[t[a++]]+s[t[a++]]+"-"+s[t[a++]]+s[t[a++]]+"-"+s[t[a++]]+s[t[a++]]+"-"+s[t[a++]]+s[t[a++]]+"-"+s[t[a++]]+s[t[a++]]+s[t[a++]]+s[t[a++]]+s[t[a++]]+s[t[a++]]}var o=t(),f=[1|o[0],o[1],o[2],o[3],o[4],o[5]],m=16383&(o[6]<<8|o[7]),v=0,y=0;var i={v1:function(t,e,a){var s=e&&a||0,r=e||[],n=null!=(t=t||{}).clockseq?t.clockseq:m,o=null!=t.msecs?t.msecs:(new Date).getTime(),i=null!=t.nsecs?t.nsecs:y+1,g=o-v+(i-y)/1e4;if(g<0&&null==t.clockseq&&(n=n+1&16383),(g<0||v<o)&&null==t.nsecs&&(i=0),1e4<=i)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=o,m=n;var l=(1e4*(268435455&(o+=122192928e5))+(y=i))%4294967296;r[s++]=l>>>24&255,r[s++]=l>>>16&255,r[s++]=l>>>8&255,r[s++]=255&l;var c=o/4294967296*1e4&268435455;r[s++]=c>>>8&255,r[s++]=255&c,r[s++]=c>>>24&15|16,r[s++]=c>>>16&255,r[s++]=n>>>8|128,r[s++]=255&n;for(var d=t.node||f,u=0;u<6;u++)r[s+u]=d[u];return e||p(r)},parse:function(t,e,a){var s=e&&a||0,r=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){r<16&&(e[s+r++]=n[t])});r<16;)e[s+r++]=0;return e}};i.unparse=p,i.BufferClass=e,taggstar.lib.uuid={generate:function(){var t=+new Date,e=t-taggstar.initTimestamp;return i.v1({msecs:t,nsecs:e%1e4})}}}(),function(){var j=taggstar.exception.Error,x=taggstar.util,s="_taggstar_ses",l="_taggstar_exp",a="_taggstar_exps",r="_taggstar_vid",u="_taggstar_cfg",k="tagg_module",T="tagg_style",R="tagg_jquery",h="|TAGGSTAR|",c=[{id:"sp",value:"socialProof"},{id:"asst",value:"asst"}];taggstar.loaded=!1,taggstar.version="3.21.0",taggstar.constant={null:"_taggstar_null"},taggstar.console=[],taggstar.asst={},taggstar.sp={},taggstar.log=function(t,e){(taggstar.debug||!taggstar.configured&&(taggstar.params&&taggstar.params.taggDebug||x&&x.getQueryParams().taggDebug))&&(e=e||"log",console[e]("TAGGSTAR: ",t),taggstar.console.push({level:e,message:t}))},taggstar.setup=function(){return new Promise(function(y,h){if(taggstar.configured)h(new j({message:"taggstar already configured",code:"CORE40",severity:99}));else{var t,e,a,s,b=taggstar.sri&&taggstar.sri.js,w=taggstar.sri&&taggstar.sri.css,C=taggstar.sri&&taggstar.sri.jquery,r=taggstar.tm&&taggstar.tm.key,n=taggstar.tm&&taggstar.tm.configUrl,o=taggstar.tm&&taggstar.tm.rgn,i=function(t){function e(t){var e=parseInt(t,10);return!isNaN(e)&&e}var a,s,r,n,o,i,g,l,c,d,u,p,f=taggstar.config,m=taggstar.tm&&taggstar.tm.style,v=[];t?(r=t.config&&t.config.config,n=t.config&&t.config.libs,i=t.config&&t.config.fileSet,"true"!==t.experienceRequired&&!0!==t.experienceRequired||(f.sp.experienceRequired=!0,f.experienceRequired=!0),!t.recs||"true"!==t.recs.experienceRequired&&!0!==t.recs.experienceRequired||(f.asst.experienceRequired=!0),i?(a=i.default&&i.default.css,s=i.default&&i.default.js,(o=taggstar.devFileSet)&&(a=i[o]&&i[o].css,s=i[o]&&i[o].js),a&&s?(f.version=t.version||f.version,r&&(!1!==(g=e(r.maxDataLayerTries))&&-1<g&&(f.tries=g),!1!==(l=e(r.dataLayerRetryIntervalMs))&&-1<l&&(f.interval=l),!1!==(c=e(r.errorMinSeverity))&&(f.errorMinSeverity=c),u=r.errorSendingProbability,p=parseFloat(u),!1!==(d=!isNaN(p)&&p)&&0<=d&&(f.errorSendingProbability=d)),f.currencyCode=r&&r.defaultCurrencyCode||f.currencyCode,f.defaultLocale=t.defaultLocale||f.defaultLocale,f.jquery=n&&n.jquery||f.jquery,f.sitePrefix=t.config&&t.config.sitePrefix||f.sitePrefix,f.urls.apiRoot=t.apiHostname||f.urls.apiRoot,m&&v.push(x.loadTag(a,"link","head",T,w)),f.jquery&&v.push(x.loadTag(f.jquery,"script","head",R,C)),v.length?Promise.all(v).then(function(t){t.forEach(function(t){taggstar.log(t.url+" "+t.tag+" tag loaded","info"),"script"===t.tag&&t.id===R&&(taggstar.$=jQuery.noConflict(!0))}),x.loadTag(s,"script","body",k,b).then(function(t){taggstar.log(t.url+" script tag loaded","info"),delete taggstar.tm,y(!0)}).catch(h)}).catch(h):x.loadTag(s,"script","body",k,b).then(function(t){taggstar.log(t.url+" script tag loaded","info"),delete taggstar.tm,y(!0)}).catch(h)):h(new j({message:"config json data (fileSet) is null/invalid",code:"CORE01",severity:99}))):h(new j({message:"config json data (fileSet) is null/invalid",code:"CORE01",severity:99}))):h(new j({message:"config json data is null/invalid",code:"CORE01",severity:99}))};if(!x.isCookie())return taggstar.log("cookie not supported","info"),void y(!1);taggstar.log("setup started","info"),taggstar.initTimestamp=Date.now(),taggstar.params=Object.assign({},taggstar.params,x.getQueryParams()),taggstar.config=taggstar.initConfig(r,taggstar.params.taggEnv,n,o),taggstar.log("config object created with default values","info"),taggstar.configured=!0,taggstar.fakeData=taggstar.params.taggFakeData,taggstar.keepUI=taggstar.params.taggKeepUI,taggstar.devFileSet=taggstar.params.taggDFS,delete taggstar.params.taggKeepUI,delete taggstar.params.taggEnv,delete taggstar.params.taggDFS,taggstar.debug="prod"!==taggstar.config.environment||0<Object.keys(taggstar.params).length,(t=!taggstar.debug&&x.loadLocalStorage(u))?i(t):(e=taggstar.config,a=e.api.configuration,s=e.urls.configRoot+x.renderTemplate(a.endpoint,{query:"?flattened=false"}),a.mock&&(s=a.mock),x.jsonCall(a.verb,s).then(function(t){return taggstar.log("request config from api server","info"),t&&!taggstar.debug&&(taggstar.log("create local storage for config","info"),x.saveLocalStorage(u,t,60)),t}).then(i).catch(h))}})},taggstar.sp.boot=function(c,d){return new Promise(function(t,e){var a,s,r=0,n=!1,o=taggstar.config,i=o.tries,g=o.interval,l=o.jquery;"function"==typeof c?(taggstar.booting=!0,taggstar.log("booting..."),s=setInterval(function(){if(taggstar.booting){if(taggstar.$||l||(taggstar.$=window.jQuery),!taggstar.$)return i<=++r?(clearInterval(s),delete taggstar.booting,void e(new j({message:"jQuery couldn't be loaded. jQuery not found",code:"CORE02",severity:99,module:"socialproof"}))):void(r%5==0&&taggstar.log("jQuery not loaded","warn"));if(!a)try{o.sp.module=a=c(),o.module=o.sp.module}catch(t){return i<=++r?(clearInterval(s),delete taggstar.booting,void e(t instanceof j?t:new j({stack:t.stack,name:t.name,message:t.message,code:"CORE03",severity:99,module:"socialproof"}))):void 0}if(a&&a!==taggstar.constant.null){if(!d||!d[a]||"function"!=typeof d[a].condition)return clearInterval(s),delete taggstar.booting,void e(new j({message:"settings invalid (module name or related condition function exists? )",code:"CORE31",severity:99}));if(!n)try{n=d[a].condition()}catch(t){return i<=++r?(clearInterval(s),delete taggstar.booting,void e(t instanceof j?t:new j({stack:t.stack,name:t.name,message:t.message,code:"CORE28",severity:99}))):void 0}if(n){if(clearInterval(s),delete taggstar.booting,"function"!=typeof d[a].module)return void e(new j({message:"settings invalid (module function exists? )",code:"CORE32",severity:99}));taggstar.log("successful boot");try{d[a].module(),t(!0)}catch(t){return void e(t instanceof j?t:new j({stack:t.stack,name:t.name,message:t.message,code:"CORE33",severity:99}))}}else{if(i<=++r)return clearInterval(s),delete taggstar.booting,void e(new j({message:"condition failed (data layer missing?)",code:"CORE30",severity:99}));r%5==0&&taggstar.log("waiting for condition function","warn")}}else{if(i<=++r)return clearInterval(s),delete taggstar.booting,void(a===taggstar.constant.null?(taggstar.log("null module detected!","warn"),t(!0)):e(new j({message:"booting failed during module detection (data layer missing?)",code:"CORE29",severity:99,module:"socialproof"})));a===taggstar.constant.null&&(a=void 0),r%5==0&&taggstar.log("waiting for module detection function","warn")}}},g)):e(new j({message:"first parameter of taggstar.boot should be type of function",code:"CORE25",severity:99,module:"socialproof"}))})},taggstar.boot=taggstar.sp.boot;taggstar.init=function(t){if(!taggstar.configured)throw new j({message:"config object not created yet",code:"CORE34",severity:20});if(t.hasOwnProperty("environment")||t.hasOwnProperty("key"))throw new j({message:"key/environment values cannot be set",code:"CORE27",severity:20});if(t.hasOwnProperty("experienceRequired"))throw new j({message:"experienceRequired value cannot be set",code:"CORE35",severity:20});if(t.hasOwnProperty("experienceId")&&!t.experienceId.trim())throw new j({message:"experienceId value is not valid",code:"CORE36",severity:20});if(t.hasOwnProperty("sp")){if(t.sp.hasOwnProperty("experienceRequired"))throw new j({message:"experienceRequired value cannot be set",code:"CORE35",severity:20});if(t.sp.hasOwnProperty("experienceId")&&!t.sp.experienceId.trim())throw new j({message:"experienceId value is not valid",code:"CORE36",severity:20})}if(t&&(t.sp=t.sp||{},t.sp.experienceRequired=taggstar.config.experienceRequired,t.sp.experienceId=t.experienceId||"",taggstar.$.extend(taggstar.config.sp,t.sp),delete t.sp),t.hasOwnProperty("asst")){if(t.asst.hasOwnProperty("experienceRequired"))throw new j({message:"experienceRequired value cannot be set",code:"ASST36",severity:20,module:"asst:"+(taggstar.config.asst&&taggstar.config.asst.pageType)});if(t.asst.hasOwnProperty("experienceId")&&!t.asst.experienceId.trim())throw new j({message:"experienceId value is not valid",code:"ASST35",severity:20,module:"asst:"+(taggstar.config.asst&&taggstar.config.asst.pageType)});taggstar.$.extend(taggstar.config.asst,t.asst),delete t.asst}taggstar.$.extend(taggstar.config,t)},taggstar.submitData=function(r,n){return new Promise(function(s,c){var t,d,e,a;taggstar.config?(t=taggstar.config.api[r])?(e=t.verb,d=taggstar.config.urls.apiRoot+t.endpoint,d+=x.createTaggstarQueryString(),taggstar.log("posting data","info"),taggstar.log(n,"info"),a={url:d,data:JSON.stringify(n),dataType:"json",type:e,contentType:!1,success:function(t,e,a){t.result&&t.result.success?s({responseData:t,jqXHR:a}):c(new j({message:t.result.errorMessage,code:"CORE08",severity:51}))},error:function(t,e,a){var s,r,n,o=t&&t.responseJSON,i=o&&o.result,g=a||"error",l=51;t&&"412"==t.status&&(x.removeLocalStorage(u),taggstar.versionMismatch||(s=taggstar.config.sp.module||taggstar.config.asst.module,r=taggstar.config.key,n=taggstar.config.region,taggstar.versionMismatch=!0,taggstar.tm={key:r,style:"conversion"!==s,region:n},taggstar.$("#"+T).remove(),taggstar.$("#"+k).remove(),taggstar.$("#"+R).remove(),x.setPageData("configured",!1,"asst"),taggstar.configured=!1,taggstar.setup().catch(taggstar.exception.handle)),l=-1),c(new j({message:x.renderTemplate("{errorMessage}: {detailMessage} for url: {url}",{errorMessage:g,url:d,detailMessage:i&&i.errorMessage?i.errorMessage:""}),code:"CORE09",severity:l}))}},taggstar.$.ajax(a)):c(new j({message:"unknown API method: "+r,code:"CORE07",severity:99})):c(new j({message:"config not found",code:"CORE13",severity:99}))})},taggstar.productRequest=function(n,o){return new Promise(function(e,a){var t,s;if(t="update"===(o=o||"visit")?"productUpdate":"product","visit"===o||"update"===o)if(n.id)if(n.name=taggstar._sanitizeName(n.name),(s=taggstar._sanitizePrice(n.price)).error)a(new j({message:s.error,code:"CORE06",severity:49}));else{n.price=s.price,n.category=taggstar._sanitizeCategory(n.category);var r=taggstar._buildRequest({product:n},"sp","product");taggstar.submitData(t,r).then(function(t){taggstar._addResponseToCookie(t.responseData,t.jqXHR,"sp"),e(t.responseData)}).catch(function(t){a(t)})}else a(new j({message:"no product id",code:"CORE10",severity:51}));else a(new j({message:"invalid action type: "+o,code:"CORE05",severity:99}))})},taggstar.categoryRequest=function(s){return new Promise(function(e,a){var t;!Array.isArray(s.products)||Array.isArray(s.products)&&0===s.products.length?a(new j({message:"product ids for category cannot be empty",code:"CORE26",severity:51})):(s.category=taggstar._sanitizeCategory(s.category),s.products.some(function(t){return!t})?a(new j({message:"no product id for category: "+s.category,code:"CORE14",severity:51})):(t=taggstar._buildRequest(s,"sp","category"),taggstar.submitData("category",t).then(function(t){taggstar._addResponseToCookie(t.responseData,t.jqXHR,"sp"),e(t.responseData)}).catch(function(t){a(t)})))})},taggstar.basketRequest=function(s){return new Promise(function(e,a){var t;s.lineItems=x.cleanDuplicateProducts(s.lineItems),t=taggstar._buildRequest({basket:s},"sp","basket"),taggstar.submitData("basket",t).then(function(t){taggstar._addResponseToCookie(t.responseData,t.jqXHR,"sp"),e(t.responseData)}).catch(function(t){a(t)})})},taggstar.conversionRequest=function(r,n){return new Promise(function(e,a){var t,s;r.id?(s=taggstar._sanitizePrice(r.totalPrice)).error?a(new j({message:s.error,code:"CORE16",severity:49})):(r.orderItems=x.cleanDuplicateProducts(r.orderItems),r.currency=r.currency?r.currency:taggstar.config.currencyCode,t=taggstar._buildRequest({order:r},null,"conversion",n),taggstar.submitData("conversion",t).then(function(t){x.debugDialog("Conversion successful!",t.responseData,"green"),e(t.responseData)}).catch(function(t){x.debugDialog("Conversion server error!",t,"red"),a(t)})):a(new j({message:"no order id",code:"CORE15",severity:51}))})},taggstar.eventRequest=function(r,n){return new Promise(function(e,a){var t,s;s="sp"===(n=n||"sp")?x.getPageData("responseData")&&x.getPageData("responseData").eventGroupId:x.getPageData("responseData",n)&&x.getPageData("responseData",n).eventGroupId,r.eventGroupId||(r.eventGroupId=s),t=taggstar._buildRequest({event:r},n,"event"),taggstar.submitData("asst"==n?"eventAssistant":"event",t).then(function(t){taggstar.log("Following event successfully recorded:\n"+JSON.stringify(r,null,2)),e(t.responseData)}).catch(function(t){a(t)})})},taggstar.eventQueryRequest=function(s,r){return new Promise(function(e,a){var t;r=r||"sp",t=taggstar._buildRequest({query:s},r,"event"),taggstar.submitData("eventQuery",t).then(function(t){taggstar.log("Success"),taggstar.log(t.responseData),e(t.responseData)}).catch(function(t){a(t)})})},taggstar.assistantRequest=function(s){return new Promise(function(e,a){var t;s&&s.productIds&&(!Array.isArray(s.productIds)||Array.isArray(s.productIds)&&0===s.productIds.length)?a(new j({message:"product ids for assistant cannot be empty",code:"ASST26",severity:51,module:"asst:"+(taggstar.config.asst&&taggstar.config.asst.pageType)})):(t=taggstar._buildRequest(s,"asst"),taggstar.submitData("asst",t).then(function(t){taggstar._addResponseToCookie(t.responseData,t.jqXHR,"asst"),e(t.responseData)}).catch(function(t){a(t)}))})},taggstar.productQueryRequest=function(l){return new Promise(function(e,a){var t,s,r,n,o,i,g=taggstar.util.createTaggstarQueryString();g?g+="&":g="?",!Array.isArray(l)||Array.isArray(l)&&0===l.length?a(new j({message:"product ids for getProducts cannot be empty",code:"CORE26",severity:51})):l.some(function(t){return!t})?a(new j({message:"missing product id",code:"CORE14",severity:51})):((t=taggstar._getClientObj())&&(t.locale&&(g+="locale="+t.locale+"&"),t.deviceType&&(g+="deviceType="+t.deviceType+"&")),(s=taggstar._getExperimentObj("sp"))&&0<Object.keys(s).length&&("experience"===Object.keys(s)[0]?g+="experienceId="+s.experience.id+"&":g+="experimentId="+s.experiment.id+"&experimentGroup="+s.experiment.group+"&"),(r=taggstar.config&&taggstar.config.pageType)&&(g+="pageType="+r+"&"),g+="ids="+l.join(","),taggstar.config?(n=taggstar.config.api.products)?(i=n.verb,o=taggstar.config.urls.apiRoot+n.endpoint,o+=g,taggstar.log("getting data","info"),taggstar.util.jsonCall(i,o).then(function(t){taggstar._addResponseToCookie(t,null,"sp"),e(t)}).catch(function(t){a(t)})):a(new j({message:"unknown API method: products",code:"CORE07",severity:99})):a(new j({message:"config not found",code:"CORE13",severity:99})))})},taggstar.getVisitor=function(t){var e=taggstar._updateVisitorSession();return{sessionId:e,id:taggstar._updateVisitorId(t||e)}},taggstar.getExperimentGroup=function(){return taggstar.getExperimentGroupV2("sp")},taggstar.getExperimentGroupV2=function(t){var e=taggstar._getExperimentDataV2();return e&&e[t]&&e[t].group},taggstar.getDetail=function(t){return taggstar.pageData&&taggstar.pageData[t]&&taggstar.pageData[t].responseData&&taggstar.pageData[t].responseData.detail},taggstar.handleProductResponse=function(n){return new Promise(function(t,e){taggstar.log("sp response received","info"),taggstar.log(n,"info");var a,s=n.socialProof,r=s&&Array.isArray(s)&&s.length?s[0].messages:[];for(a=r.length-1;0<=a;a--)r[a].message||(r.splice(a,1),taggstar.exception.handle(new j({message:"missing message body",code:"CORE19",severity:81})));t(r)})},taggstar.handleProductResponseWithAttr=function(l){return new Promise(function(t,e){taggstar.log("sp response received","info"),taggstar.log(l,"info");var a,s,r=l.socialProof,n=l.products,o=r&&Array.isArray(r)&&r.length?r[0].messages:[],i=r&&Array.isArray(r)&&r.length&&r[0].pinnedMessages||[],g=n&&Array.isArray(n)&&n.length?n[0]:{};for(a=o.length-1;0<=a;a--)o[a].message||(o.splice(a,1),taggstar.exception.handle(new j({message:"missing message body",code:"CORE19",severity:81})));for(s=i.length-1;0<=s;s--)i[s].message||(o.splice(s,1),taggstar.exception.handle(new j({message:"missing pinned message body",code:"CORE19",severity:81})));t({messages:o,pinnedMessages:i,product:g})})},taggstar.handleRequest=taggstar.handleProductResponse,taggstar.handleResponseMulti=function(d,u){return new Promise(function(t,e){taggstar.log("sp response received","info"),taggstar.log(d,"info");var a,s,r,n,o,i,g,l=d.socialProof,c={};if(u&&(a=d.products,s={},r={}),l&&Array.isArray(l)&&0<l.length)for(n=0;n<l.length;n++)i=(o=l[n]).product&&o.product.id,g=o.product&&o.product.variant&&JSON.stringify(o.product.variant),i?(o.messages&&(c[g?i+h+g:i]=o.messages),u&&o.pinnedMessages&&(s[g?i+h+g:i]=o.pinnedMessages)):taggstar.exception.handle(new j({message:"missing product id",code:"CORE20",severity:81}));if(u&&a&&Array.isArray(a)&&0<a.length)for(n=0;n<a.length;n++)(i=(o=a[n])&&o.id)?r[i]=o:taggstar.exception.handle(new j({message:"missing product id in products",code:"CORE20",severity:81}));t(u?{products:r,messages:messages,pinnedMessages:s}:c)})},taggstar.handleResponseMultiWithAttr=function(t){return handleResponseMulti(t,!0)},taggstar.handleAssistantResponse=function(s){return new Promise(function(t,e){taggstar.log("assistant response received","info"),taggstar.log(s,"info");try{var a={shoppingAssistant:s.shoppingAssistant.reduce(function(t,e){var a=e.products.map(function(a){var t=e.socialProof.reduce(function(t,e){return e.product.id===a.id&&(t=t.concat(e.messages.map(function(t){return{category:t.category,code:t.code,data:t.data,message:t.message,messageTagId:t.messageTagId}}))),t},[]);return Object.assign({},a,{socialProofMessages:t})});return t[e.tagId]={tagTitle:e.tagTitle||e.tagId,productCount:e.productCount,products:a},t},{}),templates:s.templates.reduce(function(t,e){return t[e.id]=e.template,t},{}),query:function(){if(0<s.query.products.length){var e=s.query.products[0],t=(s.query.socialProof.find(function(t){return t.product.id===e.id})||{messages:[]}).messages.map(function(t){return{category:t.category,code:t.code,data:t.data,message:t.message,messageTagId:t.messageTagId}});return Object.assign({},e,{socialProofMessages:t})}return{}}()};taggstar.log(a,"info"),t(a)}catch(t){e(new Error({message:"invalid query result",code:"ASST13",severity:99,module:"asst:"+(taggstar.config.asst&&taggstar.config.asst.pageType)}))}})},taggstar._defaultMessageParams={firstDelay:500,delayBetween:2500,fade:750,hold:3500,isMobile:!1,tries:50,testInterval:500,insertFunction:"append",wrapperClass:"tagg-balloons-wrapper",extraClass:"",extraBalloonClass:"",closeButton:!1,decor:!1,balloonDisplayCount:0,animatePre:{opacity:0},animateIn:{opacity:1},animateOut:{opacity:0},customAnimation:!1,iconCss:null,txtCss:null,closeCss:null,wrapperStyle:null,experienceWrapperClass:""},taggstar.displayMessageBalloons=function(f,m,t,v,e,y){return new Promise(function(r,n){if(Array.isArray(f)&&f.length){var o,i,g=[],l=x.getBalloonParams(t,e,y),c=0,d=y?"searchingPinnedDom":"searchingDom";taggstar[d]=!0,i=setInterval(function(){if(taggstar[d]){var t,e,a=taggstar.$(m);try{e="function"!=typeof v||v()}catch(t){return++c>l.tries?(clearInterval(i),taggstar[d]=!1,void n(t instanceof j?t:new j({stack:t.stack,name:t.name,message:t.message,code:"CORE04",severity:99}))):void 0}if(!e||0===a.length)return++c>l.tries?(clearInterval(i),taggstar[d]=!1,void n(new j({message:"balloon anchor not present in DOM: "+m+"/condition does not met",code:"CORE11",severity:99}))):void taggstar.log("looking for balloon anchor DOM element/running condition","warn");clearInterval(i),delete taggstar[d],taggstar.log("adding balloons to DOM"),t=x.getBalloonContainer(l);try{a[l.insertFunction](t)}catch(t){return void n(new j({message:"problem applying jQuery method: "+l.insertFunction,code:"CORE12",severity:99}))}o=taggstar.$("."+l.wrapperClass.replace(" ","."));for(var s=0;s<f.length;s++)!function(t){var e=x.getBalloon(f[t],"balloon",l,t);g[t]=setTimeout(function(){l.balloonDisplayCount++,l.customAnimation?l.customAnimation(o,e,l,t,function(t){u(l,e,t)},function(){p(e)}):(e.css(l.animatePre),o.append(e),e.animate(l.animateIn,l.fade,function(){u(l,e)}))},l.firstDelay+t*l.delayBetween)}(s);r(!0)}},l.testInterval)}else r(!1);function u(t,e,a){if(a=a||s,t.closeButton&&e.find(".tagg-x").click(function(){taggstar.log("balloon close button clicked");var t=e.data("tagg-index");clearTimeout(g[t]),a(e)}),0===e.data("tagg-index")&&"function"==typeof t.callback)try{t.callback()}catch(t){taggstar.exception.handle(new j({message:"reporting callback failed with error "+t,code:"CORE22",severity:81}))}(y&&!t.keepUI||!y&&!taggstar.keepUI)&&setTimeout(function(){a(e)},t.hold)}function s(t){t.animate(l.animateOut,l.fade,function(){p(t)})}function p(t){t.css({zIndex:"-1",opacity:0,display:"block"}),l.balloonDisplayCount--,0===l.balloonDisplayCount&&(taggstar.log("removing balloon container"),o.remove())}})},taggstar.displayPinnedMessageBalloons=function(t,e,a,s,r){return taggstar.displayMessageBalloons(t,e,a,s,r,!0)},taggstar.displayMessageBalloonsMulti=function(p,f,m,t,v,y){return new Promise(function(t,e){var a,s,r,n,o,i,g,l,c,d,u=x.getBalloonParams(m,v,y);if("function"==typeof f){for(a in p)for(s=p[a],r=0;r<s.length;r++)if(n=s[r],o=x.getBalloonContainer(u),i=x.getBalloon(n),o.append(i),-1<a.indexOf(h)&&(c=(l=a.split(h))[0],d=l[1]),(g=c?f(c,JSON.parse(d)):f(a))&&g.length){taggstar.log("adding balloons to DOM");try{g[u.insertFunction](o)}catch(t){return void e(new j({message:"problem applying jQuery method: "+u.insertFunction,code:"CORE23",severity:99}))}}else taggstar.log("no anchor returned for product "+(c?c+" and for variant ["+d+"]":a),"warn");t(!0)}else e(new j({message:"findAnchor parameter not a function",code:"CORE24",severity:99}))})},taggstar.displayPinnedMessageBalloonsMulti=function(t,e,a,s,r){return taggstar.displayMessageBalloonsMulti(t,e,a,s,r,!0)},taggstar.displayAssistant=function(S,q,t){return new Promise(function(T,R){var P=JSON.parse(JSON.stringify(S));if(Object.values(P.shoppingAssistant).some(function(t){return t.products&&0<t.products.length})){P.selectedTag=function(t){var e=null,a=-1/0;for(var s in t)t.hasOwnProperty(s)&&t[s].productCount>a&&(a=t[s].productCount,e=s);return e}(P.shoppingAssistant);var I,O=taggstar.$.extend(taggstar._defaultParams.assistant,t),_=0,D=taggstar.util,A=O.isMobile,E=P.query;D.setPageData("searchingDom",!0,"assistant"),I=setInterval(function(){if(D.getPageData("searchingDom","assistant")){var a,t,e=taggstar.$(q);if(0===e.length)return++_>O.tries?(clearInterval(I),D.setPageData("searchingDom",!1,"assistant"),void R(new j({message:"assistant anchor not present in DOM: "+q,code:"CORE11",severity:99}))):void taggstar.log("looking for assistant anchor DOM element","warn");clearInterval(I),D.deletePageData("searchingDom","assistant"),taggstar.log("adding assistant to DOM"),0===taggstar.$("style.tagg-asst").length&&taggstar.$("#tagg_style").before(taggstar.$("<style>",{class:"tagg-asst",text:".tagg-asst-body-no-scroll{overflow:hidden}.tagg-asst-modal-background{display:none;position:fixed;z-index:1000000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:rgba(0,0,0,0.4)}.tagg-asst-modal{background-color:#fff;margin:auto;padding:1rem;border:1px solid #1e1e1e;border:1px solid rgba(0,0,0,0.45);width:80%;height:80%;max-width:1024px;max-height:768px;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%)}.tagg-asst-modal-background-mobile .tagg-asst-modal{width:100%;height:100%;border:0;top:0;left:0;transform:unset;max-height:100%;overflow-y:scroll}.tagg-asst-content{display:flex;height:100%}.tagg-asst-modal-background-mobile .tagg-asst-content{flex-direction:column}.tagg-asst-filter-close,.tagg-asst-modal-close{color:#333;float:right;font-size:26px;font-weight:bold;position:absolute;right:8px;top:-5px}.tagg-asst-filter-close{color:#999}.tagg-asst-filter-close:hover,.tagg-asst-filter-close:focus,.tagg-asst-modal-close:hover,.tagg-asst-modal-close:focus{text-decoration:none;cursor:pointer}.tagg-asst-content .tagg-asst-left{width:25%;min-width:25%;height:100%}.tagg-asst-content .tagg-asst-right{height:100%;overflow-y:scroll}.tagg-asst-header h1{font-size:2rem}.tagg-asst-tag-list-container{width:100%;padding:1rem;box-sizing:border-box}.tagg-asst-tags-list{list-style:none;padding:0;display:flex;flex-wrap:wrap;gap:.5rem}.tagg-asst-tags-list li{background-color:#fff;border:1px solid #f1f1f1;padding:.2rem .8rem;cursor:pointer;white-space:nowrap}.tagg-asst-tags-list li.tagg-asst-tag-active{background-color:#f1f1f1;border-color:#999}.tagg-asst-tag{display:none;--auto-grid-min-size:10rem;grid-template-columns:repeat(auto-fill,minmax(var(--auto-grid-min-size),1fr));grid-gap:.5rem}.tagg-asst-tag.tagg-asst-selected-tag{display:grid}.tagg-asst-main-card .tagg-asst-image-container img{max-width:100%;height:auto;display:block}.tagg-asst-card img{max-width:100%}.tagg-asst-info-container{margin-top:auto}.tagg-asst-filter-sort-container{display:flex;justify-content:space-between;padding:10px;position:relative}.tagg-asst-filter-container,.tagg-asst-sortby-container{flex:1;margin:.2rem;width:fit-content}.tagg-asst-filter-container button,.tagg-asst-sortby-container button{width:100%;height:50px;background-color:#f1f1f1;border:0;cursor:pointer}.tagg-asst-sortby-menu{display:none;position:absolute;background-color:#fff;box-shadow:0 8px 16px 0 rgba(0,0,0,0.2);width:200px;z-index:1000}.tagg-asst-sortby-menu a{display:block;padding:10px 20px;text-decoration:none;color:black}.tagg-asst-sortby-menu a:hover{background-color:#f1f1f1}.tagg-asst-filter-overlay{height:100%;position:fixed;z-index:2;top:0;width:100%;right:-100%;background-color:#fff;overflow-x:hidden;transition:.5s}"})),e[O.insertFunction](taggstar.$(D.assistant.renderAssistantTemplate(O.buttonTemplate,S.templates)).addClass(O.buttonClass).on("click",function(){taggstar.eventRequest({action:"open"},"asst"),a.show(),taggstar.$("body").addClass("tagg-asst-body-no-scroll")})),a=taggstar.$("<div>",{class:O.modalBackgroundClass+(A?" "+O.modalBackgroundClass+"-mobile":"")}).appendTo("body"),taggstar.$("<div>",{class:O.modalClass}).appendTo("."+O.modalBackgroundClass),taggstar.$(D.assistant.renderAssistantTemplate(O.closeButtonTemplate,S.templates)).addClass(O.closeButtonClass).on("click",function(){taggstar.eventRequest({action:"close"},"asst"),a.hide(),taggstar.$("body").removeClass("tagg-asst-body-no-scroll")}).appendTo("."+O.modalClass),t=taggstar.$("<div>",{class:O.contentClass});var s,r,n,o,i,g,l,c,d,u,p,f=function(){taggstar.$("."+O.contentHeaderClass).empty().append(taggstar.$(D.assistant.renderAssistantTemplate(O.headerTemplate,S.templates,P.shoppingAssistant[P.selectedTag])))},m=function(t){var e,a;for(var s in t?(e=taggstar.$("."+O.contentCardsContainerClass)).empty():e=taggstar.$("<div>",{class:O.contentCardsContainerClass}),P.shoppingAssistant)(a=D.assistant.getAssistant(s,P.shoppingAssistant[s],O,s===P.selectedTag))&&e.append(a);return e},v=function(t){return D.assistant.renderAssistantTemplate(O.sortByText,S.templates)+" "+D.assistant.renderAssistantTemplate("age"===t?O.sortByAgeText:O.sortByPopularityText,S.templates)},y=function(){taggstar.$(".tagg-asst-sortby-button").html(v(P.shoppingAssistant[P.selectedTag].sortBy||"popularity"))},h=(i=taggstar.$("<div>",{class:"tagg-asst-sortby-container"}),s=taggstar.$("<button>",{class:"tagg-asst-sortby-button",html:v("popularity"),click:function(){taggstar.$(".tagg-asst-sortby-menu").show()}}),r=taggstar.$("<div>",{class:"tagg-asst-sortby-menu"}),o=taggstar.$("<a>",{html:D.assistant.renderAssistantTemplate(O.sortByPopularityText,S.templates),click:function(){k("popularity")}}),n=taggstar.$("<a>",{html:D.assistant.renderAssistantTemplate(O.sortByAgeText,S.templates),click:function(){k("age")}}),r.append(o),r.append(n),i.append(s),i.append(r),i),b=function(){function t(){var t=taggstar.$(this);taggstar.$("."+O.contentTagsListClass+" li").removeClass("tagg-asst-tag-active"),t.addClass("tagg-asst-tag-active"),P.selectedTag=t.attr("data-tag"),f(),y(),m(!0);var e={action:"tag",data:{label:P.selectedTag}};taggstar.eventRequest(e,"asst")}var e,a=taggstar.$("<div>",{class:O.contentTagsContainerClass}),s=P.shoppingAssistant;for(var r in O.tagsLabelTemplate&&a.append(taggstar.$(D.assistant.renderAssistantTemplate(O.tagsLabelTemplate,S.templates))),e=taggstar.$("<ul>",{class:O.contentTagsListClass}),s)e.append(taggstar.$("<li>",{"data-tag":r,html:s[r].tagTitle||r,class:r===P.selectedTag?"tagg-asst-tag-active":"",click:t}));return a.append(e),a}(),w=O.headerTemplate?taggstar.$("<div>",{class:O.contentHeaderClass}).append(taggstar.$(D.assistant.renderAssistantTemplate(O.headerTemplate,S.templates,P.shoppingAssistant[P.selectedTag]))):null,C=D.assistant.getAssistantCard("main",P.query,O,P.selectedTag,P.shoppingAssistant[P.selectedTag]),x=m();A?(w&&t.append(w),C&&t.append(C),g=taggstar.$("<div>",{class:O.contentFilterSortContainerClass}),t.append(g),c=taggstar.$("<button>",{html:D.assistant.renderAssistantTemplate(O.filterButtonText,S.templates)}).on("click",function(){taggstar.$(".tagg-asst-filter-overlay").css({right:"0"})}),l=taggstar.$("<div>",{class:"tagg-asst-filter-overlay"}),d=taggstar.$(D.assistant.renderAssistantTemplate(O.filterCloseButtonTemplate,S.templates)).addClass(O.filterCloseButtonClass).on("click",function(){taggstar.$(".tagg-asst-filter-overlay").css("right","-100%")}),u=taggstar.$(D.assistant.renderAssistantTemplate(O.filterDoneButtonTemplate,S.templates)).addClass(O.filterDoneButtonClass).on("click",function(){taggstar.$(".tagg-asst-filter-overlay").css("right","-100%")}),l.append(d),l.append(b),l.append(u),(p=taggstar.$("<div>",{class:O.contentFilterContainerClass})).append(l),p.append(c),g.append(p),g.append(h),t.append(x)):E?(t.append(taggstar.$("<div>",{class:O.contentLeftClass}).append(C).append(b)),t.append(taggstar.$("<div>",{class:O.contentRightClass}).append(w).append(h).append(x))):(w&&t.append(w),t.append(taggstar.$("<div>",{class:O.contentFilterSortContainerClass}).append(b).append(h)),t.append(x)),t.appendTo("."+O.modalClass),taggstar.$(window).click(function(t){var e=t.target;e==a[0]&&(taggstar.$("body").removeClass("tagg-asst-body-no-scroll"),a.hide()),"tagg-asst-sortby-button"!==(e&&e.className)&&taggstar.$(".tagg-asst-sortby-menu").hide()}),taggstar.$(".tagg-asst-prd-link").on("click",function(t){t.preventDefault();var e=this.href,a={action:"product",data:{label:this.getAttribute("data-product")}};taggstar.eventRequest(a,"asst").then(function(){window.location.href=e}).catch(function(){window.location.href=e})}),T(!0)}function k(t){P.shoppingAssistant[P.selectedTag].sortBy=t,m(!0),y(),taggstar.$(".tagg-asst-sortby-menu").hide()}},O.testInterval)}else T(!1)})},taggstar._defaultParams={pinnedMessages:{firstDelay:500,delayBetween:2500,fade:750,hold:3500,isMobile:!1,tries:50,testInterval:500,insertFunction:"append",wrapperClass:"tagg-pinned-balloons-wrapper",extraClass:"",extraBalloonClass:"",closeButton:!1,decor:!1,balloonDisplayCount:0,animatePre:{opacity:0},animateIn:{opacity:1},animateOut:{opacity:0},customAnimation:!1,experienceWrapperClass:"",keepUI:!1},assistant:{buttonClass:"tagg-asst-button",modalBackgroundClass:"tagg-asst-modal-background",modalClass:"tagg-asst-modal",contentClass:"tagg-asst-content",contentCardsContainerClass:"tagg-asst-cards-container",contentRightClass:"tagg-asst-right",contentLeftClass:"tagg-asst-left",contentHeaderClass:"tagg-asst-header",contentFilterSortContainerClass:"tagg-asst-filter-sort-container",contentFilterContainerClass:"tagg-asst-filter-container",contentTagsContainerClass:"tagg-asst-tag-list-container",contentTagsListClass:"tagg-asst-tags-list",closeButtonClass:"tagg-asst-modal-close",filterCloseButtonClass:"tagg-asst-filter-close",contentSelectedTagSectionClass:"tagg-asst-selected-tag",tagClass:"tagg-asst-tag",isMobile:!1,tries:50,testInterval:500,insertFunction:"append",balloonAnchor:"",balloonAnchorInsertFunction:"append",balloonWrapperClass:"tagg-asst-balloons-wrapper",balloonExtraClass:"",balloonExtraBalloonClass:"",balloonCloseButton:!1,balloonDecor:!1,utils:{},tagsLabelTemplate:"<label>{tags}:</label>",sortByLabelTemplate:"<label>{sortby}:</label>",cardImageTemplate:'<div class="tagg-asst-image-container"><a class="tagg-asst-prd-link" data-event-value="1" data-product="{id}" data-category="{tagId}" href="{url}"><img alt="{title}" title="{title}" src="{imageUrl}" /></a></div>',cardInfoTemplate:'<div class="tagg-asst-info-container"><div class="tagg-asst-info-title"><a class="tagg-asst-prd-link" data-event-value="1" data-product="{id}" data-category="{tag}" href="{url}">{title}</a></div><div class="tagg-asst-info-price">{price}</div></div>',cardAdditionalTemplate:"",headerTemplate:"<h1>{header}</h1>",buttonTemplate:"<button>{button}</button>",closeButtonTemplate:"<span>&times;</span>",filterCloseButtonTemplate:"<span>&times;</span>",filterDoneButtonTemplate:"<button>{done}</button>",filterDoneButtonClass:"tagg-asst-filter-done",filterButtonText:"{filters}",sortByPopularityText:"{popularity}",sortByAgeText:"{age}",sortByText:"{sortby}"}},taggstar._saveExperimentData=function(t){var e=JSON.stringify(t);x.setCookie(a,e,129600)},taggstar._updateVisitorSession=function(t){var e,a=x.getCookie(s)||t;return a?(x.setCookie(s,a,30),a):(e=taggstar.config.idGenerator(),taggstar.log("created new session cookie "+e),x.setCookie(s,e,30),e)},taggstar._updateVisitorId=function(t){var e,a=x.getCookie(r)||t;return a?(x.setCookie(r,a,129600),a):(e=taggstar.config.idGenerator(),taggstar.log("created new visitor cookie "+e),x.setCookie(r,e,129600),e)},taggstar._getExperimentData=function(t){var e=x.getCookie(l);return e?x.decodeCookieString(e,t):null},taggstar._getExperimentDataV2=function(){var t=x.getCookie(a);return t?x.decodeCookieStringV2(t):null},taggstar._buildRequest=function(t,e,a,s){var r,n,o,i=taggstar.config;for(var g in r={visitor:taggstar.getVisitor()},t)t.hasOwnProperty(g)&&(r[g]=t[g]);if((n=taggstar._getClientObj())&&(r.client=n),(o=taggstar._getExperimentObj(e,a))&&0<Object.keys(o).length)for(var l=0;l<Object.keys(o).length;l++)r[Object.keys(o)[l]]=o[Object.keys(o)[l]];return s&&(r.dimensions=x.validateDimensions(s)),"asst"===e&&"event"!==a&&(r.page={type:i.asst.pageType},i.asst.pageId&&(r.page.id=i.asst.pageId)),r},taggstar._getExperimentObj=function(t,e){if("event"===e)return null;var a,s,r=taggstar.config,n=taggstar._getExperimentData(!0),o=taggstar._getExperimentDataV2()||{},i={};if(n&&(o.sp={id:n.experimentId,group:n.experimentGroup},taggstar._saveExperimentData(o),taggstar.util.deleteCookie(l)),"conversion"===e)for(var g=0;g<c.length;g++)r[s=(a=c[g]).id].experienceRequired?r[s].experienceId&&(i.experiences=i.experiences||{},i.experiences[a.value]={id:r[s].experienceId}):o[s]&&o[s].id&&o[s].group&&(i.experiments=i.experiments||{},i.experiments[a.value]={id:o[s].id,group:o[s].group});else r[t].experienceRequired?r[t].experienceId&&(i={experience:{id:r[t].experienceId}}):(o[t]||(o[t]={id:"",group:""},taggstar._saveExperimentData(o)),o[t]&&o[t].id&&(i={experiment:{id:o[t].id,group:o[t].group}}));return i},taggstar._getClientObj=function(){var t,e=taggstar.config;return(!taggstar.debug&&e.version||e.deviceType||e.locale)&&(t={},!taggstar.debug&&e.version&&(t.expectedSiteConfigVersion=e.version),e.deviceType&&(t.deviceType=e.deviceType),e.locale&&(t.locale=e.locale)),t},taggstar._addResponseToCookie=function(t,e,a){var s;taggstar.config[a].experienceRequired||taggstar._debugParamUsed()?taggstar.config[a].experienceRequired&&taggstar._deleteExperimentCookie(a):(s=taggstar._getExperimentDataV2(),t.experiment&&(s[a].group=t.experiment.group,s[a].id=t.experiment.id),taggstar._saveExperimentData(s)),t.result&&x.setPageData("responseData",{eventGroupId:t.result.eventGroupId,moduleRunId:t.result.moduleRunId,detail:t.detail},"sp"===a?taggstar.config.sp.module:a)},taggstar._deleteExperimentCookie=function(t){var e=taggstar._getExperimentDataV2();e?(e[t]&&delete e[t],Object.keys(e).length?taggstar._saveExperimentData(e):x.deleteCookie(a)):x.deleteCookie(a)},taggstar._sanitizeName=function(t){return t&&"string"==typeof t?t=(t=(t=(t=t.trim()).replace(/\s+/g," ")).substring(0,64))||"-":"-"},taggstar._sanitizeCategory=function(t){return t=t&&"string"==typeof t?((t=(t=(t=(t=(t=t.replace(/^\s*/g,"").replace(/\s*$/g,"")).replace(/\s*\/\s*/g,"/")).replace(/\s+/g," ")).replace(/\/$/,"")).substring(0,256))&&"/"!=t[0]&&"-"!==t&&(t="/"+t),t||"-"):"-"},taggstar._sanitizePrice=function(t){var e,a={error:"",price:0},s=0;if("number"==typeof t)return a.price=t,a;if(t)try{if(!(0<=(e=t.search(/\d+/))))return a.error="price field contains no digits",a;if(t=t.substring(e),s=parseFloat(t),!isNaN(s))return a.price=s,a;a.error="price field can't be parsed"}catch(t){a.error=t.message}return a},taggstar._debugParamUsed=function(){return taggstar.params.taggExperimentId||taggstar.params.taggExperimentGroup||taggstar.params.taggExperienceId||taggstar.params.taggFakeData||taggstar.params.taggDeviceType||taggstar.params.taggEnv},taggstar.log("methods loaded","info"),taggstar.loaded=!0,taggstar.setup().catch(taggstar.exception.handle)}();