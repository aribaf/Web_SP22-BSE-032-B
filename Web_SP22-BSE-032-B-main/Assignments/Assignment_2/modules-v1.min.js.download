/*! jigsawonlinecom v1.0.0 | 2025-01-24T15:05:21 | fe0569938e100846f8fe61ee0058197444125c98 | Copyright. All rights reserved. 2025. Digital Media Technologies Ltd. */
"use strict";!function(){if("function"==typeof window.CustomEvent)return;function a(t,e){return new a(t,e=e||{bubbles:!1,cancelable:!1,detail:void 0})}a.prototype=window.Event.prototype,window.CustomEvent=a}(),function(){function n(){var t=E[P],e="desktop";return taggstar.$(window).width()<=t&&(e="mobile"),e}function i(){return"mobile"===n()}function a(){function t(t){return t&&-1<I.indexOf(t)}var e=taggstar.$("body").data("tagg-insert-function"),a=taggstar.$("body").data("tagg-insert-function-m");return i()&&t(a)&&(e=a),t(e)||(e=k[P][n()]),e}function r(e){function t(t){return t&&j(t,e).length}var a=taggstar.$("body").data("tagg-anchor"),r=taggstar.$("body").data("tagg-anchor-m");return i()&&t(r)&&(a=r),t(a)||(a=q[P][n()]),j(a,e)}function e(t){var e;switch(P){case"basket":e=taggstar.$(O(t))}return r(e)}function o(t){var e={},a=taggstar.getVisitor();return e.version=3,e.visitor=a&&a.id,e.module=B.module,B.experienceRequired||t&&t.hasOwnProperty("experiment")&&t.experiment&&(e.experiment={id:t.experiment.id,group:t.experiment.group}),t.action?(e.type="action",e.action=t.action):(e.type="socialProof",e.socialProof=function(t){var e,a,r,n,i,o,s,c=[],g=t.socialProof;if(g)for(e=0;e<g.length;e++)for(r=(n=g[e]).product&&n.product.id,i=n.messages,a=0;a<i.length;a++)s={productId:r,code:(o=i[a]).code,data:o.data,text:o.message},c.push(s);return c}(t)),e}function s(a){return new Promise(function(t){try{var e=new CustomEvent("taggstar:response",{detail:o(a)});document.dispatchEvent(e),taggstar.analytics=taggstar.analytics||[],taggstar.analytics.push({data:o(a),timestamp:Date.now()})}catch(t){taggstar.log("error submitting tracking object")}finally{t(a)}})}function c(){taggstar.log("window resized - "+n());var t=taggstar.$(".tagg-balloons-wrapper");t.length?y!==n()&&t.each(function(){var t=a(),e=taggstar.$(this);r(void 0)[t](e),y=n()}):(taggstar.log("removing resize listener"),taggstar.$(window).off("resize",c))}function t(){return l=B.experienceRequired?l||taggstar.params&&taggstar.params.taggExperienceId||taggstar.$("body").data("tagg-experience"):void 0,f={lineItems:[]},l&&document.querySelectorAll(".cart-table__item-wrapper[data-id]").forEach(function(t){var e=t.getAttribute("data-id");t.getAttribute("tagg-processed")||(f.lineItems.push({id:e,unitPrice:"1.00",quantity:1}),t.setAttribute("tagg-processed",!0))}),(!B.experienceRequired||l)&&f.lineItems.length&&e(C(f,"lineItems.0.id")).length}function g(t,e,a){function r(){t.css({opacity:0}),clearInterval(w),setTimeout(function(){isLastBalloon&&t.remove()},1e3)}M(),taggstar.log("custom animation fired");var n=0<taggstar.$(".tagg-balloons-wrapper").find("div.tagg-balloon").length,i={opacity:1};e.css({opacity:0}),taggstar.$(".tagg-balloons-wrapper").append(e),n?(i.opacity=0,w=setInterval(function(){i.opacity=0===i.opacity?1:0,i.opacity?(setTimeout(function(){e.css({opacity:1}),e.prev().css({visibility:"hidden"})},500),e.prev().css({opacity:0})):(setTimeout(function(){e.prev().css({opacity:1,visibility:"unset"}),e.css({visibility:"hidden"})},500),e.css({opacity:0}))},a.hold)):setTimeout(function(){t.css({opacity:1}),i.opacity=1,e.css(i)},a.firstDelay);var o=e.get(0).querySelector(".tagg-x");o&&(o.setAttribute("tabindex",0),o.setAttribute("aria-label","close message balloon"),o.setAttribute("role","button"),o.addEventListener("keydown",function(t){" "!==t.key&&"Enter"!==t.key&&"Spacebar"!==t.key||r()}),o.addEventListener("click",r))}function u(){clearInterval(_),_=setInterval(function(){document.querySelectorAll(".tagg-basket-page .tagg-balloon").forEach(function(t){var e=t.closest(".cart-table__item");if(e&&e.querySelector(".ajax-cart__next-day-message")){var a=e&&e.querySelector(".ajax-cart__inner-middle");taggstar.log(a),a&&(a.style.paddingTop="0px",a.style.paddingBottom="6px",clearInterval(_))}})},500)}function d(){B.experienceRequired&&(R.experienceId=l),R.detail=!0,Object.keys(R).length&&taggstar.init(R),m?taggstar.displayMessageBalloonsMulti(m,e,{extraClass:"tagg-basket-page tagg-"+L,insertFunction:a()}).then(function(){u()}).catch(A):taggstar.basketRequest(f).then(s).then(taggstar.handleResponseMulti).then(function(t){m=t,taggstar.displayMessageBalloonsMulti(t,e,{extraClass:"tagg-basket-page tagg-"+L,insertFunction:a()}).then(function(){u()}).catch(A)}).catch(A)}var l,p,f,m,y,h,v,b,w,x,_,I=["before","after","prepend","append"],k={product:{desktop:"append",mobile:"append"},basket:{desktop:"prepend",mobile:"prepend"}},q={product:{desktop:".product-gallery .product-gallery__featured-carousel",mobile:".product-gallery .product-gallery__featured-carousel"},basket:{desktop:".ajax-cart__inner-top",mobile:".ajax-cart__inner-top"}},E={category:767,product:767,basket:767},P=taggstar.constant.null,$=!1,R={},S=-1,B=taggstar.config,L=B.key,A=taggstar.exception.handle,C=taggstar.util.getObjectByPath,j=function(t,e){var a;return(a=e?e.is(t)?e:e.find(t):taggstar.$(t)).selector||(a.selector=t),a},O=function(t){return document.querySelector('.cart-table__item-wrapper[data-id="'+t+'"]')},M=function(){var t=document.querySelector("#ProductGalleryMain-1"),e=t&&t.querySelector(".swiper-slide-active"),a=document.querySelector(".tagg-product-page");if(t&&e&&a){var r=t.offsetHeight-e.offsetHeight;a.style.bottom=20+r+"px"}},z={product:{condition:function(){l=taggstar.params&&taggstar.params.taggExperienceId||taggstar.$("body").data("tagg-experience");var t=C(b,"0.ecommerce.items.0")||{};return $=!1,p={},p={id:C(t,"item_id"),name:C(t,"item_name"),price:C(t,"price"),category:"-"},(!B.experienceRequired||l)&&p.id&&e().length},module:function(){B.experienceRequired&&(R.experienceId=l),Object.keys(R).length&&taggstar.init(R),taggstar.productRequest(p).then(s).then(taggstar.handleProductResponse).then(function(t){t,taggstar.log(t),$?taggstar.log("OOS: Suppressing messages"):function(t){t.length,taggstar.displayMessageBalloons(t,e().selector,{extraClass:"tagg-product-page tagg-"+L+(1<t.length?" tagg-two-balloons":""),insertFunction:a(),firstDelay:0,hold:6e3,customAnimation:g,delayBetween:0,closeButton:!0}).catch(A)}(t),taggstar.$(window).off("resize",c).on("resize",c)}).catch(A),setInterval(M,200)}},basket:{condition:t,module:function(){var e;try{d(),e=setInterval(function(){t()&&d()},3*B.interval)}catch(t){clearInterval(e)}}},conversion:{condition:function(t){if(l=B.experienceRequired?l||taggstar.params&&taggstar.params.taggExperienceId||taggstar.$("body").data("tagg-experience"):void 0,t){var e,a="";return t.purchaseId?!t.orders||t.orders&&0===t.orders.length?{success:!1,message:"Empty orders items"}:t.revenue?(h={id:t.purchaseId,currency:t.currency||"GBP",totalPrice:t.revenue,orderItems:[]},t.orders.forEach(function(t){h.orderItems.push({id:C(t,"id"),unitPrice:C(t,"price"),category:C(t,"category"),quantity:C(t,"quantity")})}),(e=h.id&&h.currency&&h.totalPrice&&h.orderItems.length)||(a=a||"Condition failed"),{success:e,message:a}):{success:!1,message:"Revenue was not sent"}:{success:!1,message:"Purchase id was not included"}}return h={id:C(x,"0.ecommerce.transaction_id"),currency:C(x,"0.ecommerce.currency")||"GBP",totalPrice:C(x,"0.ecommerce.value"),orderItems:[]},(C(x,"0.ecommerce.items")||[]).forEach(function(t){t.item_id&&h.orderItems.push({id:C(t,"item_id"),unitPrice:C(t,"price"),category:C(t,"item_category"),quantity:C(t,"quantity")})}),h.id&&h.currency&&h.totalPrice&&h.orderItems.length},module:function(){R.currencyCode=h.currency,taggstar.init(R),taggstar.conversionRequest(h).then(s).then(function(t){taggstar.log("conversion successful","info"),taggstar.log(t,"info")}).catch(A)}}};!function(){var t,e,a,r,n=taggstar.util.getCookie("_taggstar_dbg");if(n)for(taggstar.debug=!0,t=n.split("|"),e=0;e<t.length;e++)switch((a=t[e].split(":"))[0]){case"kui":taggstar.keepUI="true"===a[1];break;case"prd":r=a[1];break;case"id":"client"===r&&a[1]&&(taggstar.params.taggExperienceId=a[1]),"server"===r&&a[1]&&(taggstar.params.taggExperimentId=a[1]);break;case"grp":"server"===r&&a[1]&&(taggstar.params.taggExperimentGroup=a[1])}}();var G=setInterval(function(){try{!function(){var t,e,a,r;if((t=window.dataLayer&&window.dataLayer.filter(function(t){return"add_to_cart"==t.event})).length&&t.length!==S){if(S=t.length,e=t[t.length-1],!(a=(C(e,"ecommerce.items.0")||{}).item_id))return taggstar.log("No product Id");r={category:"basket",name:"add",data:{label:a,value:1}},taggstar.log(r),taggstar.eventRequest(r).then(function(){delete r.eventGroupId,s({action:r})}).catch(A)}}()}catch(t){taggstar.log(t),clearInterval(G)}},1e3);taggstar.boot(function(){return taggstar.log(document.querySelector(".product-gallery .product-gallery__featured-carousel")),y=n(),v=window.dataLayer&&window.dataLayer.filter(function(t){return t.page_type}),b=window.dataLayer&&window.dataLayer.filter(function(t){return"view_item"===t.event}),x=window.dataLayer&&window.dataLayer.filter(function(t){return"purchase"===t.event}),v?"Product"===C(v,"0.page_type")&&b.length?P="product":0<document.querySelectorAll(".cart-table__item-wrapper[data-id]").length&&"Basket"===C(v,"0.page_type")?P="basket":"Order Confirmation"===C(v,"0.page_type")&&x.length&&(P="conversion"):P=taggstar.constant.null,taggstar.log(P),P},z).catch(A)}(window);